{"componentChunkName":"component---src-layouts-post-layout-tsx","path":"/korea-webtoon-api-update/","result":{"data":{"markdownRemark":{"id":"6b3a1858-27f6-5961-8c64-358503d15a66","html":"<p class=\"my-4 whitespace-pre-wrap\">2020년 말쯤 웹툰 통합 정보 사이트를 만들어 보자는 생각으로 Webtoon Hub라는 토이 프로젝트를 진행하면서 필요했던 웹툰 정보들을 뿌려주는 서버를 만들었다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">프로젝트를 완성하고 해당 API를 버려두긴 아까워 문서도 만들고 공개 호스팅으로 돌리면서 대학교 동기나 후배들에게 제공하고 있었는데 이번에 업데이트할 내용이 있어서 이렇게 글로 남겨본다.</p>\n<h3 id=\"-daum-웹툰의-개편\" style=\"position:relative;\" class=\"font-bold mt-10 mb-4 text-2xl\"><a href=\"#-daum-%EC%9B%B9%ED%88%B0%EC%9D%98-%EA%B0%9C%ED%8E%B8\" aria-label=\" daum 웹툰의 개편 permalink\" class=\"anchor before\" class=\"text-blue-500 hover:underline\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💥 Daum 웹툰의 개편</h3>\n<p class=\"my-4 whitespace-pre-wrap\">2021년 8월 기존 Daum 웹툰이 Kakao 웹툰으로 개편되었는데 단순 명칭 변경이 아닌 실제 페이지에 많은 변화가 있었다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">이 때문에 기존에 만들어 두었던 API 사용이 불가능한 상황이라 해당 프로젝트를 업데이트해야 했다.</p>\n<h3 id=\"-korea-webtoon-api의-업데이트\" style=\"position:relative;\" class=\"font-bold mt-10 mb-4 text-2xl\"><a href=\"#-korea-webtoon-api%EC%9D%98-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\" aria-label=\" korea webtoon api의 업데이트 permalink\" class=\"anchor before\" class=\"text-blue-500 hover:underline\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👉 Korea Webtoon API의 업데이트</h3>\n<p class=\"my-4 whitespace-pre-wrap\">기존 API는 정해진 시간마다 크롤링한 데이터를 가공해 Express로 JSON 형태의 데이터 뿌려주는 방식이었다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">각 플랫폼별로 크롤링 모듈을 따로 설계해 두어서 사실 해당 모듈만 수정하면 되는 작업이었지만 그동안 벼르고 있었던 NestJS를 써보자는 생각으로 오히려 Naver 웹툰 크롤러 모듈을 제외한 모든 코드를 다시 작성하게 되었다.</p>\n<h4 id=\"업데이트한-부분은-다음과-같다\" style=\"position:relative;\" class=\"font-bold mt-10 mb-4 text-xl\"><a href=\"#%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8%ED%95%9C-%EB%B6%80%EB%B6%84%EC%9D%80-%EB%8B%A4%EC%9D%8C%EA%B3%BC-%EA%B0%99%EB%8B%A4\" aria-label=\"업데이트한 부분은 다음과 같다 permalink\" class=\"anchor before\" class=\"text-blue-500 hover:underline\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>업데이트한 부분은 다음과 같다.</h4>\n<ul class=\"list-disc ml-5\">\n<li class=\"list-item\">Express 기반에서 NestJS로 전환</li>\n<li class=\"list-item\">Daum 웹툰 크롤러를 Kakao 웹툰에 맞게 변경</li>\n<li class=\"list-item\">데이터 구조 재정의</li>\n<li class=\"list-item\">Kakao 페이지 추가</li>\n<li class=\"list-item\">검색 API 추가</li>\n</ul>\n<h2 id=\"웹툰-정보-수집\" style=\"position:relative;\" class=\"font-bold mt-10 mb-4 text-3xl\"><a href=\"#%EC%9B%B9%ED%88%B0-%EC%A0%95%EB%B3%B4-%EC%88%98%EC%A7%91\" aria-label=\"웹툰 정보 수집 permalink\" class=\"anchor before\" class=\"text-blue-500 hover:underline\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>웹툰 정보 수집</h2>\n<h3 id=\"naver-웹툰\" style=\"position:relative;\" class=\"font-bold mt-10 mb-4 text-2xl\"><a href=\"#naver-%EC%9B%B9%ED%88%B0\" aria-label=\"naver 웹툰 permalink\" class=\"anchor before\" class=\"text-blue-500 hover:underline\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Naver 웹툰</h3>\n<p class=\"my-4 whitespace-pre-wrap\">사실 이전에 크롤링 코드를 모듈화 해놓고 그 부분은 건들지 않아도 정상 작동해서 이번 업데이트에서는 결과 데이터 형식을 제외하고는 크게 수정한 부분이 없었다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">네이버 웹툰은 한 페이지에 있는 웹툰들은 모두 한 번에 표시되는 방식이었고 딱히 크롤링을 방지하기 위한 장치도 없었다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">덕분에 정석적인 방법으로 크롤링 가능했다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">다만 파싱 속도와 이미지 퀄리티 때문에 PC 페이지가 아닌 모바일 페이지를 대상으로 크롤링했다.</p>\n<h3 id=\"kakao-웹툰\" style=\"position:relative;\" class=\"font-bold mt-10 mb-4 text-2xl\"><a href=\"#kakao-%EC%9B%B9%ED%88%B0\" aria-label=\"kakao 웹툰 permalink\" class=\"anchor before\" class=\"text-blue-500 hover:underline\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kakao 웹툰</h3>\n<p class=\"my-4 whitespace-pre-wrap\">Kakao 웹툰은 특이하게 Kakao 웹툰과 Kakao 페이지로 나뉘어 서비스되고 있다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">처음에는 Naver 웹툰의 크롤러처럼 사이트 자체를 크롤링해서 정보를 얻으려고 시도했지만 Kakao 웹툰은 초기에 모든 정보들을 가져와 웹에 뿌려주는 방식이 아닌 필요할 때 서버에 요청해 그때그때 필요한 데이터들을 가져와 뿌려주는 방식이라 성능이 좋지 못했다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">그 밖에도 여러 가지 문제점이 많았고 정말 많은 것을 시도했던 것 같다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">이 부분에 대해서는 아래 \"🔥 발생했던 이슈\"에 후술 하겠다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">사실 Kakao 웹툰으로 개편되기 이전 Daum 웹툰에서는 사이트에서 발생하는 요청들을 개발자 도구로 분석해보면 요청을 보내는 URL을 찾을 수 있었고 별다른 인증 없이 외부 클라이언트에서도 같은 데이터를 요청할 수 있었는데 당연히 이 부분이 막혔을 것이라 생각했지만 Kakao 웹툰에서도 요청 URL만 바뀌었을 뿐 여전히 가능했다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">이런 방법이 가능하다면 HTML 코드를 파싱 하는 단계를 건너뛰고 요청과 응답 자체도 웹 페이지 자체를 크롤링하는 보다 훨씬 빨랐으므로 Kakao 웹툰과 페이지 둘 다 위 방법으로 데이터를 수집했다.</p>\n<h3 id=\"-발생했던-이슈\" style=\"position:relative;\" class=\"font-bold mt-10 mb-4 text-2xl\"><a href=\"#-%EB%B0%9C%EC%83%9D%ED%96%88%EB%8D%98-%EC%9D%B4%EC%8A%88\" aria-label=\" 발생했던 이슈 permalink\" class=\"anchor before\" class=\"text-blue-500 hover:underline\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔥 발생했던 이슈</h3>\n<p class=\"my-4 whitespace-pre-wrap\">처음에 Kakao 웹툰의 웹 페이지 자체를 크롤링하면서 생겼던 문제들과 해결했던 방법들이다.</p>\n<p class=\"my-4 whitespace-pre-wrap\"><strong>일반적인 사용자 접근이 아니면 페이지 자체 접근 차단</strong></p>\n<blockquote class=\"border-l-4 border-gray-500 pl-4 italic\">\n<p class=\"my-4 whitespace-pre-wrap\">puppeteer가 핸들링하는 chromium에 사용자 정보를 추가</p>\n</blockquote>\n<p class=\"my-4 whitespace-pre-wrap\"><strong>짧은 시간내에 여러번 요청을 보내면 사이트에서 해당 IP를 일시적으로 차단</strong></p>\n<blockquote class=\"border-l-4 border-gray-500 pl-4 italic\">\n<p class=\"my-4 whitespace-pre-wrap\">새로운 페이지를 여는 딜레이를 크게 잡음(크롤링 속도 느려짐)</p>\n</blockquote>\n<p class=\"my-4 whitespace-pre-wrap\"><strong>Kakao 웹툰 페이지의 각 element들의 속성이 불규칙하고 구조가 복잡함</strong></p>\n<blockquote class=\"border-l-4 border-gray-500 pl-4 italic\">\n<p class=\"my-4 whitespace-pre-wrap\">불규칙한 부분이나 구조가 복잡한 부분은 puppeteer로 직접 핸들링해서 크롤링하고 규칙적인 속성들만 우선적으로 크롤링 (크롤링 속도 느려짐)</p>\n</blockquote>\n<p class=\"my-4 whitespace-pre-wrap\"><strong>해외 IP 차단(Heroku = 미국 서버)</strong></p>\n<blockquote class=\"border-l-4 border-gray-500 pl-4 italic\">\n<p class=\"my-4 whitespace-pre-wrap\">프록시를 사용하여 데이터 수집 (속도 느려짐, 프록시 상태에 의존)</p>\n</blockquote>\n<p class=\"my-4 whitespace-pre-wrap\">결국 전혀 다른 방법을 사용하게 되었지만 해당 부분을 해결하기 위한 코드는 따로 분리해 <a href=\"https://github.com/HyeokjaeLee/kakao-webtoon-crawler\" class=\"text-blue-500 hover:underline\">kakao-webtoon-crawler repository</a>에 저장해두었다.</p>\n<h2 id=\"마지막으로\" style=\"position:relative;\" class=\"font-bold mt-10 mb-4 text-3xl\"><a href=\"#%EB%A7%88%EC%A7%80%EB%A7%89%EC%9C%BC%EB%A1%9C\" aria-label=\"마지막으로 permalink\" class=\"anchor before\" class=\"text-blue-500 hover:underline\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마지막으로</h2>\n<p class=\"my-4 whitespace-pre-wrap\">이번에 Express 코드를 NestJS로 바꾸면서 확실히 구조가 잘 정리된다는 느낌을 받았다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">그리고 Express를 사용할 때보다 기본적으로 제공하고 있는 기능들이 많아서 초기 설정에 많은 시간을 들이지 않아도 된다는 점도 매우 편리했다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">앞으로도 NestJS를 사용한 프로젝트들을 많이 진행해볼 생각이다.</p>\n<p class=\"my-4 whitespace-pre-wrap\">해당 API의 코드는 <a href=\"https://github.com/HyeokjaeLee/korea-webtoon-api\" class=\"text-blue-500 hover:underline\">korea-webtoon-api repository</a>에 공개되어있다.</p>","headings":[{"depth":3,"value":"💥 Daum 웹툰의 개편","id":"-daum-웹툰의-개편"},{"depth":3,"value":"👉 Korea Webtoon API의 업데이트","id":"-korea-webtoon-api의-업데이트"},{"depth":4,"value":"업데이트한 부분은 다음과 같다.","id":"업데이트한-부분은-다음과-같다"},{"depth":2,"value":"웹툰 정보 수집","id":"웹툰-정보-수집"},{"depth":3,"value":"Naver 웹툰","id":"naver-웹툰"},{"depth":3,"value":"Kakao 웹툰","id":"kakao-웹툰"},{"depth":3,"value":"🔥 발생했던 이슈","id":"-발생했던-이슈"},{"depth":2,"value":"마지막으로","id":"마지막으로"}],"frontmatter":{"title":"Webtoon API 업데이트","date":"21년 11월 17일","description":"Daum 웹툰의 개편으로 인한 API 업데이트","tags":["project"]}},"previous":{"fields":{"slug":"/nest-js/"},"frontmatter":{"title":"NestJS 웹서버 구축하기","titleImage":"https://user-images.githubusercontent.com/71566740/139354021-96e05704-52c7-466f-857a-4046a2a5f916.png"}},"next":{"fields":{"slug":"/covid-19-api-update/"},"frontmatter":{"title":"Covid-19 API 업데이트","titleImage":"https://user-images.githubusercontent.com/71566740/144737959-6f46ade7-6020-490e-94c9-a6462e6c1c1e.png"}}},"pageContext":{"id":"6b3a1858-27f6-5961-8c64-358503d15a66","previousPostId":"8848ceac-a7f1-5fbd-a221-dcfa1096816c","nextPostId":"a937fa1a-96e4-5242-a641-8d28b1305f2f"}},"staticQueryHashes":["2964855266","3766628212","4278130389","825490659"],"slicesMap":{}}